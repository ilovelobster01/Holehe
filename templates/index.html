<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holehe Web Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 800px;
            width: 90%;
            margin: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .search-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="email"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="email"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            display: none;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        
        .results-container {
            display: none;
            margin-top: 30px;
        }
        
        .results-summary {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .summary-item:last-child {
            margin-bottom: 0;
        }
        
        .profiles-list {
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .profile-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .profile-item:last-child {
            border-bottom: none;
        }
        
        .profile-name {
            font-weight: 600;
            color: #333;
        }
        
        .profile-domain {
            color: #667eea;
            text-decoration: none;
            word-break: break-all;
            font-size: 0.9em;
        }
        
        .profile-domain:hover {
            text-decoration: underline;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: background-color 0.3s;
            display: inline-block;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .reset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: background-color 0.3s;
            display: inline-block;
        }
        
        .reset-btn:hover {
            background: #545b62;
        }
        
        .back-to-top-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            position: fixed;
            bottom: 30px;
            right: 30px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            display: none;
            z-index: 1000;
        }
        
        .back-to-top-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .results-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .results-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .filter-section {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .filter-btn {
            background: #e9ecef;
            color: #495057;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
        }
        
        .filter-btn:hover {
            background: #5a6fd8;
            color: white;
        }
        
        .filter-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .stat-found { color: #28a745; }
        .stat-not-found { color: #6c757d; }
        .stat-rate-limited { color: #ffc107; }
        .stat-error { color: #dc3545; }
        
        .profile-item.found {
            border-left: 4px solid #28a745;
        }
        
        .profile-item.not-found {
            border-left: 4px solid #6c757d;
            background: #f8f9fa;
        }
        
        .profile-item.rate-limited {
            border-left: 4px solid #ffc107;
            background: #fffbf0;
        }
        
        .profile-item.error {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }
        
        .profile-status {
            font-size: 0.85em;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-found {
            background: #d4edda;
            color: #155724;
        }
        
        .status-not-found {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .status-rate-limited {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .profile-item.hidden {
            display: none !important;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        
        .no-results {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }
        
        .profile-additional-info {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .profile-additional-info strong {
            color: #333;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .logo {
                font-size: 2em;
            }
            
            .profile-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .results-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .results-actions > div {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .results-title {
                text-align: center;
                font-size: 1.3em;
            }
            
            .back-to-top-btn {
                bottom: 20px;
                right: 20px;
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .download-btn, .reset-btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .filter-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .filter-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">📧 Holehe</div>
            <div class="subtitle">Find registered accounts from email addresses</div>
        </div>
        
        <form class="search-form" id="searchForm">
            <div class="form-group">
                <label for="email">Enter Email Address:</label>
                <input type="email" id="email" name="email" required 
                       placeholder="e.g. example@domain.com" autocomplete="off">
            </div>
            <button type="submit" class="search-btn" id="searchBtn">
                🔍 Check Email Accounts
            </button>
        </form>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Starting search...</div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div class="results-actions" id="resultsActions" style="display: none;">
                <h2 class="results-title">🎯 Search Results</h2>
                <div>
                    <button class="download-btn" id="downloadBtnTop">
                        📄 Download PDF Report
                    </button>
                    <button class="reset-btn" id="resetBtn">
                        🔄 New Search
                    </button>
                </div>
            </div>
            <div class="results-summary" id="resultsSummary"></div>
            
            <div class="filter-section" id="filterSection" style="display: none;">
                <h3 style="margin-top: 0; color: #333;">📊 Results Breakdown</h3>
                <div class="filter-stats" id="filterStats"></div>
                <div>
                    <strong>Filter Results:</strong>
                    <div class="filter-buttons" id="filterButtons">
                        <button class="filter-btn active" data-filter="all">
                            🔍 Show All
                        </button>
                        <button class="filter-btn" data-filter="found">
                            ✅ Found Only
                        </button>
                        <button class="filter-btn" data-filter="not_found">
                            ❌ Not Found Only
                        </button>
                        <button class="filter-btn" data-filter="rate_limited">
                            ⚠️ Rate Limited Only
                        </button>
                        <button class="filter-btn" data-filter="error">
                            🚫 Errors Only
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="profiles-list" id="profilesList"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="download-btn" id="downloadBtnBottom" style="display: none;">
                    📄 Download PDF Report
                </button>
            </div>
        </div>
        
        <div class="error-message" id="errorMessage" style="display: none;"></div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top-btn" id="backToTopBtn">
        ↑ Top
    </button>

    <script>
        let currentSearchId = null;
        let progressInterval = null;

        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            if (!email) {
                showError('Please enter an email address');
                return;
            }
            
            // Basic email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showError('Please enter a valid email address');
                return;
            }
            
            startSearch(email);
        });

        function startSearch(email) {
            // Reset UI
            hideError();
            hideResults();
            showProgress();
            
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = true;
            searchBtn.textContent = '🔄 Searching...';
            
            // Start search
            fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `email=${encodeURIComponent(email)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentSearchId = data.search_id;
                checkProgress();
            })
            .catch(error => {
                showError('Failed to start search: ' + error.message);
                resetSearchButton();
            });
        }

        function checkProgress() {
            if (!currentSearchId) return;
            
            fetch(`/status/${currentSearchId}`)
            .then(response => response.json())
            .then(data => {
                updateProgress(data.progress || 0, data.message || 'Searching...');
                
                if (data.status === 'completed') {
                    loadResults();
                } else if (data.status === 'error') {
                    showError(data.message || 'Search failed');
                    resetSearchButton();
                } else {
                    // Continue checking
                    setTimeout(checkProgress, 1000);
                }
            })
            .catch(error => {
                showError('Failed to check progress: ' + error.message);
                resetSearchButton();
            });
        }

        function loadResults() {
            fetch(`/results/${currentSearchId}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                displayResults(data);
                hideProgress();
                resetSearchButton();
            })
            .catch(error => {
                showError('Failed to load results: ' + error.message);
                resetSearchButton();
            });
        }

        function displayResults(data) {
            const summaryDiv = document.getElementById('resultsSummary');
            const profilesDiv = document.getElementById('profilesList');
            const resultsActions = document.getElementById('resultsActions');
            const filterSection = document.getElementById('filterSection');
            const filterStats = document.getElementById('filterStats');
            const downloadBtnTop = document.getElementById('downloadBtnTop');
            const downloadBtnBottom = document.getElementById('downloadBtnBottom');
            
            // Show results actions and filter section
            resultsActions.style.display = 'flex';
            filterSection.style.display = 'block';
            
            // Summary
            summaryDiv.innerHTML = `
                <div class="summary-item">
                    <strong>Email Address:</strong>
                    <span>${data.email}</span>
                </div>
                <div class="summary-item">
                    <strong>Total Sites Checked:</strong>
                    <span>${data.total_sites}</span>
                </div>
                <div class="summary-item">
                    <strong>Search Time:</strong>
                    <span>${new Date(data.search_time).toLocaleString()}</span>
                </div>
            `;
            
            // Filter stats
            filterStats.innerHTML = `
                <div class="stat-item stat-found">
                    ✅ <span>${data.found_count || 0} Found</span>
                </div>
                <div class="stat-item stat-not-found">
                    ❌ <span>${data.not_found_count || 0} Not Found</span>
                </div>
                <div class="stat-item stat-rate-limited">
                    ⚠️ <span>${data.rate_limited_count || 0} Rate Limited</span>
                </div>
                <div class="stat-item stat-error">
                    🚫 <span>${data.error_count || 0} Errors</span>
                </div>
            `;
            
            // Combine all profiles with their types
            let allProfiles = [];
            
            // Add found profiles
            if (data.found_profiles) {
                allProfiles = allProfiles.concat(data.found_profiles.map(profile => ({
                    ...profile,
                    type: 'found',
                    displayStatus: 'Found'
                })));
            }
            
            // Add not found profiles
            if (data.not_found_profiles) {
                allProfiles = allProfiles.concat(data.not_found_profiles.map(profile => ({
                    ...profile,
                    type: 'not_found',
                    displayStatus: 'Not Found'
                })));
            }
            
            // Add rate limited profiles
            if (data.rate_limited_profiles) {
                allProfiles = allProfiles.concat(data.rate_limited_profiles.map(profile => ({
                    ...profile,
                    type: 'rate_limited',
                    displayStatus: profile.reason || 'Rate Limited'
                })));
            }
            
            // Add error profiles
            if (data.error_profiles) {
                allProfiles = allProfiles.concat(data.error_profiles.map(profile => ({
                    ...profile,
                    type: 'error',
                    displayStatus: profile.reason || 'Error'
                })));
            }
            
            // Sort profiles by site name
            allProfiles.sort((a, b) => a.site.localeCompare(b.site));
            
            // Display profiles
            if (allProfiles.length > 0) {
                profilesDiv.innerHTML = allProfiles.map(profile => {
                    let additionalInfo = '';
                    if (profile.emailrecovery) {
                        additionalInfo += `<div class="profile-additional-info"><strong>Email Recovery:</strong> ${profile.emailrecovery}</div>`;
                    }
                    if (profile.phoneNumber) {
                        additionalInfo += `<div class="profile-additional-info"><strong>Phone:</strong> ${profile.phoneNumber}</div>`;
                    }
                    if (profile.others) {
                        for (const [key, value] of Object.entries(profile.others)) {
                            additionalInfo += `<div class="profile-additional-info"><strong>${key}:</strong> ${value}</div>`;
                        }
                    }
                    
                    return `
                        <div class="profile-item ${profile.type}" data-type="${profile.type}">
                            <div style="flex-grow: 1;">
                                <div class="profile-name">
                                    ${profile.site}
                                    <span class="profile-status status-${profile.type}">${profile.displayStatus}</span>
                                </div>
                                <div class="profile-domain">${profile.domain}</div>
                                ${additionalInfo}
                            </div>
                            <div style="color: #666; font-size: 0.9em;">
                                ${profile.method || 'Unknown method'}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Show download buttons only if there are found profiles
                const hasFoundProfiles = data.found_count > 0;
                downloadBtnTop.style.display = hasFoundProfiles ? 'inline-block' : 'none';
                downloadBtnBottom.style.display = hasFoundProfiles ? 'inline-block' : 'none';
                downloadBtnTop.onclick = () => downloadPDF();
                downloadBtnBottom.onclick = () => downloadPDF();
                
                // Set up filter functionality
                setupFilters();
                
            } else {
                profilesDiv.innerHTML = '<div class="no-results">No results found for this email address.</div>';
                downloadBtnTop.style.display = 'none';
                downloadBtnBottom.style.display = 'none';
            }
            
            showResults();
            showBackToTopButton();
        }

        function downloadPDF() {
            if (currentSearchId) {
                window.open(`/download/${currentSearchId}`, '_blank');
            }
        }

        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
        }

        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }

        function updateProgress(percent, message) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = message;
        }

        function showResults() {
            document.getElementById('resultsContainer').style.display = 'block';
        }

        function hideResults() {
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('resultsActions').style.display = 'none';
            document.getElementById('filterSection').style.display = 'none';
            hideBackToTopButton();
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function resetSearchButton() {
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = false;
            searchBtn.textContent = '🔍 Check Email Accounts';
            hideProgress();
        }

        function resetSearch() {
            // Clear current search
            currentSearchId = null;
            
            // Clear input
            document.getElementById('email').value = '';
            
            // Hide results and progress
            hideResults();
            hideProgress();
            hideError();
            
            // Reset search button
            resetSearchButton();
            
            // Scroll to top
            scrollToTop();
        }

        function showBackToTopButton() {
            document.getElementById('backToTopBtn').style.display = 'block';
        }

        function hideBackToTopButton() {
            document.getElementById('backToTopBtn').style.display = 'none';
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Get filter type
                    const filterType = this.getAttribute('data-filter');
                    
                    // Apply filter
                    applyFilter(filterType);
                });
            });
        }

        function applyFilter(filterType) {
            const profileItems = document.querySelectorAll('.profile-item');
            
            profileItems.forEach(item => {
                if (filterType === 'all') {
                    item.classList.remove('hidden');
                } else {
                    const itemType = item.getAttribute('data-type');
                    if (itemType === filterType) {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                }
            });
        }

        // Event listeners for new buttons
        document.getElementById('resetBtn').addEventListener('click', resetSearch);
        document.getElementById('backToTopBtn').addEventListener('click', scrollToTop);

        // Show/hide back to top button based on scroll
        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById('backToTopBtn');
            if (window.pageYOffset > 300) {
                backToTopBtn.style.display = 'block';
            } else if (!document.getElementById('resultsContainer').style.display || 
                       document.getElementById('resultsContainer').style.display === 'none') {
                backToTopBtn.style.display = 'none';
            }
        });
    </script>
</body>
</html>